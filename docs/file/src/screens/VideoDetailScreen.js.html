<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/screens/VideoDetailScreen.js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AppContainer">AppContainer</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components">components</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ChangePasswordModal.js~ChangePasswordModal.html">ChangePasswordModal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PromptButton">PromptButton</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#screens">screens</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/screens/LoginScreen.js~EmailPasswordLogin.html">EmailPasswordLogin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/screens/MainScreen.js~MainScreen.html">MainScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/screens/MyVideoList.js~MyVideoList.html">MyVideoList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/screens/VideoDetailScreen.js~VideoDetailScreen.html">VideoDetailScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/screens/VideoListScreen.js~VideoListScreen.html">VideoListScreen</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseDate">parseDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCameraPermission">getCameraPermission</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCameraRollPermission">getCameraRollPermission</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getFileFromS3">getFileFromS3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getImage">getImage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getImageFromCameraRoll">getImageFromCameraRoll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getVideoFromCameraRoll">getVideoFromCameraRoll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-storeFileInS3">storeFileInS3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-takePhotoWithCamera">takePhotoWithCamera</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-takeVideoWithCamera">takeVideoWithCamera</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-uploadVideo">uploadVideo</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/screens/VideoDetailScreen.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React from &quot;react&quot;;
import Modal from &quot;react-native-modal&quot;;
import { Card } from &quot;react-native-elements&quot;;
import { Rating } from &quot;react-native-ratings&quot;;
import { AirbnbRating } from &quot;react-native-ratings&quot;;
import {
  View,
  Dimensions,
  StyleSheet,
  Text,
  FlatList,
  StatusBar,
  TouchableWithoutFeedback,
  Keyboard,
  ScrollView,
  KeyboardAvoidingView,
  Alert
} from &quot;react-native&quot;;

import { ScreenContainer,Button, TextField, RowBodyCheckbox } from &quot;@draftbit/ui&quot;;
import API from &quot;../../config/api&quot;;
import { getFileFromS3 } from &quot;../utils&quot;;
import { Video } from &quot;expo-av&quot;;
import { parseDate } from &quot;../utils&quot;;

const videoWidth = Dimensions.get(&quot;window&quot;).width;
const videoHeight = (videoWidth / 16) * 9;


class VideoDetailScreen extends React.Component {
  state = {
    video_detail: {},
    modal: false,
    content: 0,
    language: 0,
    visuals: 0,
    clarity: 0,
    brevity: 0,
    comment: &quot;&quot;,
    editModal: false,
    editTitle: &quot;&quot;,
    editDescription: &quot;&quot;,
    dialogVisible:false
  };

  componentDidMount() {
    StatusBar.setHidden(false);
    this.fetchDetail();
  }

  alertPopUp (mesg) {
    var message= &quot;&quot;
    if (mesg ==1){
      message=&quot;Your comment and ratings were successfully posted&quot;
    }
    else{
      message=&quot;Your changes were saved!&quot;
    }
    Alert.alert(
      &quot;Success!&quot;,
      message,
      [{ text: &quot;OK&quot;, onPress: () =&gt; { this.setState({ modal: false })} }],
      { cancelable: false }
    );
  }

 fetchDetail = async () =&gt; {
    const { navigation } = this.props;
    const res = await API.get(
      `/video/detail/${navigation.getParam(&quot;video_id&quot;)}`
    );
    const video_detail = res.data;

    video_detail.uri = await getFileFromS3(
      video_detail.aws_key,
      video_detail.aws_access
    );
    this.setState({ video_detail });
    //setting the description for the edit box 
    this.setState({ editDescription: this.state.video_detail.description })
    this.setState({ editTitle: this.state.video_detail.title})

  };

  _renderItem = ({ item }) =&gt; {
    return (
      &lt;Card&gt;
        &lt;Text style={styles.comment_user}&gt;{item.user_email}&lt;/Text&gt;
        &lt;Text style={styles.comment}&gt;{item.comment}&lt;/Text&gt;
        &lt;CommentRating rating=&quot;Content&quot; value={item.content} /&gt;
        &lt;CommentRating rating=&quot;Language&quot; value={item.lang} /&gt;
        &lt;CommentRating rating=&quot;Visuals&quot; value={item.visual} /&gt;
        &lt;CommentRating rating=&quot;Clarity&quot; value={item.clarity} /&gt;
        &lt;CommentRating rating=&quot;Brevity&quot; value={item.brevity} /&gt;
      &lt;/Card&gt;
    );
  };


  submitCommentRating = async () =&gt; {
    const { navigation } = this.props;
    let { content, language, visuals, clarity, brevity } = this.state;

    const res = await API.post(&quot;/comment&quot;, {
      video_id: navigation.getParam(&quot;video_id&quot;),
      comment: this.state.comment,
      content: content,
      lang: language,
      visual: visuals,
      clarity: clarity,
      brevity: brevity
    });
    //this.setState({ modal: false });
    this.fetchDetail();
    this.alertPopUp(1);  
  };
  
  testingVariables(acess){
    // Testing that correct variables are beeing sent to server for edit description 
    console.log(&apos;new description below&apos;)
    console.log(this.state.editDescription)
    console.log(&apos;new title below&apos;)
    console.log(this.state.editTitle)
    console.log(&apos;aws key below&apos;)
    console.log(this.state.video_detail.aws_key);
    console.log(&apos;video access below&apos;)
    console.log(acess) 
  }

  submitNewDescriptionTitle = async () =&gt; {
    this.setState({editModal: false})
    const { navigation } = this.props;
    var acess=&quot;&quot;;

    if(this.state.video_detail.is_public == &apos;1&apos;){
      acess=&apos;public&apos;
    } 
    else{
      acess=&apos;private&apos;
    }
    const res = await API.post(&quot;/video/changeDescription&quot;, {
      description: this.state.editDescription,
      aws_access: acess,
      aws_key: this.state.video_detail.aws_key
    });

    const res1 = await API.post(&quot;/video/changeTitle&quot;, {
      title: this.state.editTitle,
      aws_access: acess,
      aws_key: this.state.video_detail.aws_key
    });

    navigation.setParams({ video_title: this.state.editTitle })
    this.fetchDetail();  
    this.alertPopUp(0);
  };
 

  render() {
    return (
      &lt;ScreenContainer hasSafeArea style={styles.container}&gt;
        &lt;Video
          style={{ width: videoWidth, height: videoHeight }}
          source={{ uri: this.state.video_detail.uri }}
          useNativeControls
        /&gt;

        &lt;FlatList
          style={{ flex: 1 }}
          data={this.state.video_detail.comments}
          renderItem={this._renderItem}
          ListHeaderComponent={Description(this)}
          // keyExtractor={item =&gt; `${item.video_id}-${item.aws_key}`}
        /&gt;

        &lt;Modal isVisible={this.state.modal}&gt;
          &lt;TouchableWithoutFeedback onPress={Keyboard.dismiss}&gt;
            &lt;ScrollView style ={styles.modalContent}&gt;
              
                &lt;TextField
                  type=&quot;solid&quot;
                  label=&quot;Comment&quot;
                  multiline={true}
                  placeholder=&quot;Enter your comment for the video&quot;
                  keyboardType=&quot;default&quot;
                  value={this.state.comment}
                  onChangeText={comment =&gt; this.setState({ comment })}
                  style={styles.emailInput}
                /&gt;
                &lt;Text style={styles.ratingLabels}&gt;Content&lt;/Text&gt;
                &lt;AirbnbRating
                  showRating={false}
                  fractions={0}
                  defaultRating={0}
                  onFinishRating={r =&gt; this.setState({ content: r })}
                /&gt;
                &lt;Text style={styles.ratingLabels}&gt;Language&lt;/Text&gt;
                &lt;AirbnbRating
                  showRating={false}
                  fractions={0}
                  defaultRating={0}
                  onFinishRating={r =&gt; this.setState({ language: r })}
                /&gt;
                &lt;Text style={styles.ratingLabels}&gt;Visuals&lt;/Text&gt;
                &lt;AirbnbRating
                  showRating={false}
                  fractions={0}
                  defaultRating={0}
                  onFinishRating={r =&gt; this.setState({ visuals: r })}
                /&gt;
                &lt;Text style={styles.ratingLabels}&gt;Clarity&lt;/Text&gt;
                &lt;AirbnbRating
                  showRating={false}
                  fractions={0}
                  defaultRating={0}
                  onFinishRating={r =&gt; this.setState({ clarity: r })}
                /&gt;
                &lt;Text style={styles.ratingLabels}&gt;Brevity&lt;/Text&gt;
                &lt;AirbnbRating
                  showRating={false}
                  fractions={0}
                  defaultRating={0}
                  onFinishRating={r =&gt; this.setState({ brevity: r })}
                /&gt;

                &lt;Button
                  type=&quot;solid&quot;
                  //color={theme.colors.primary}
                  style={styles.submitButton}
                  onPress={this.submitCommentRating}
                &gt;
                  Submit your rating
                &lt;/Button&gt;

                &lt;Button
                  type=&quot;solid&quot;
                  //color={theme.colors.primary}
                  style={styles.cancelButton}
                  // to be implemened
                  onPress={() =&gt; this.setState({ modal: false })}
                &gt;
                  Cancel
                &lt;/Button&gt;
              
            &lt;/ScrollView&gt;
          &lt;/TouchableWithoutFeedback&gt;
        &lt;/Modal&gt;
      
        &lt;Modal isVisible={this.state.editModal}&gt;
        &lt;View style = {styles.modalContent}&gt;

        
        &lt;TextField
                  type=&quot;solid&quot;
                  label=&quot;New Title&quot;
                  multiline={true}
                  placeholder=&quot;Enter your new title for the video&quot;
                  keyboardType=&quot;default&quot;
                  value={this.state.editTitle}
                  onChangeText={editTitle =&gt; this.setState({ editTitle })}
                  style={styles.modalTextField}
                /&gt;
        &lt;TextField
                  type=&quot;solid&quot;
                  label=&quot;New Description&quot;
                  multiline={true}
                  placeholder=&quot;Enter your new description for the video&quot;
                  keyboardType=&quot;default&quot;
                  value={this.state.editDescription}
                  onChangeText={editDescription =&gt; this.setState({ editDescription })}
                  style={styles.modalTextField}
                /&gt;
        &lt;Button
                type=&quot;solid&quot;
                //color={theme.colors.primary}
                style={styles.submitButton}
                onPress={this.submitNewDescriptionTitle}
              &gt;
                Submit
              &lt;/Button&gt;

         &lt;Button
                type=&quot;solid&quot;
                //color={theme.colors.primary}
                style={styles.cancelButton}
                // to be implemened
                onPress={() =&gt; Alert.alert(
                  &quot;Warning!&quot;,
                  &quot;Are you sure you want to Cancel? Your changes will not be saved!&quot;,
                  [
                    { text: &quot;Yes&quot;, onPress: () =&gt; this.setState({ editModal:false}),
                  style: &quot;cancel&quot;},
                  { text: &quot;No&quot; }
                ],
                  
                  { cancelable: false }
                )}
              &gt;
                Cancel
              &lt;/Button&gt;
            
              &lt;/View&gt;
        &lt;/Modal&gt;
      &lt;/ScreenContainer&gt;
    );
  }
}

function CommentRating(props) {
  return (
    &lt;View style={styles.commentRatingContainer}&gt;
      &lt;View style={{ flex: 1, alignItems: &quot;flex-start&quot; }}&gt;
        &lt;Text&gt;{props.rating}&lt;/Text&gt;
      &lt;/View&gt;
      &lt;View style={{ flex: 3, alignItems: &quot;flex-start&quot; }}&gt;
        &lt;Rating
          startingValue={props.value}
          imageSize={15}
          showRating={false}
          readonly={true}
        /&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
}

function Description(_this) {
  const { navigation } = _this.props;
  const video_detail = _this.state.video_detail;
  const editButtonStatus = _this.state.editButton;
  return (
    &lt;View style={styles.descriptionContainer}&gt;
      &lt;Text&gt;

        {video_detail.user_email} {parseDate(video_detail.upload_time)}

      &lt;/Text&gt;
      &lt;Card&gt;
      &lt;View style={styles.descContainer}&gt;
      &lt;Text style={styles.descriptionTitle}&gt;Description&lt;/Text&gt;
      {navigation.getParam(&quot;editButton&quot;) &amp;&amp; &lt;Text
        type=&quot;solid&quot;
        style={styles.editTitle}
        onPress={() =&gt; _this.setState({ editModal: true })}
      &gt;
        [Edit Title and Description]
      &lt;/Text&gt; }
      &lt;/View&gt;
      
      &lt;Text&gt;{video_detail.description}&lt;/Text&gt;
      &lt;/Card&gt;
      &lt;Button
        type=&quot;solid&quot;
        style={styles.postCommentButton}
        onPress={() =&gt; _this.setState({ modal: true })}
      &gt;
        Rate Video and Comment
      &lt;/Button&gt;
      &lt;Text style={styles.descriptionTitle}&gt;Comments&lt;/Text&gt;
      
    &lt;/View&gt;
  );
}



const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: &quot;#fff&quot;
  },
  modalTextField:{
    margin:10
  },

  submitButton: {
    margin: 10,
    backgroundColor: &quot;green&quot;
  },
  cancelButton: {
    margin: 10,
    backgroundColor: &quot;red&quot;
  },

  videoContainer: {
    width: videoWidth,
    height: videoHeight,
    borderColor: &quot;black&quot;,
    borderWidth: 4
  },
  descContainer:{
  flex:1,
  flexDirection: &quot;row&quot;,
  justifyContent: &quot;space-between&quot;
  },
  descriptionContainer: {
    padding: 10
  },
  descriptionTitle: {
    fontWeight: &quot;bold&quot;,
    lineHeight: 30
  },
  postCommentButton: {
    height: 44,
    marginTop: 10
  },
  editButton: {
    height: 40,
    padding:0,
    width:10,
    marginTop: 5
  },
  editTitle: {
    textDecorationLine: &apos;underline&apos;
  },
  modalContent: {
    flexDirection: &quot;column&quot;,
    backgroundColor: &quot;rgba(251, 252, 253, 100)&quot;,
    padding: 22,
    //justifyContent: &quot;center&quot;,
    //alignItems: &quot;stretch&quot;,
    borderRadius: 4,
    borderColor: &quot;rgba(90, 69, 255, 100)&quot;,
    borderWidth: 5
  },
  commentRatingContainer: {
    flex: 1,
    flexDirection: &quot;row&quot;
  },
  comment_user: {
    fontSize: 14,
    fontWeight: &quot;400&quot;,
    color: &quot;#666666&quot;
  },
  comment: {
    marginTop: 3,
    marginBottom: 3,
    fontSize: 18,
    fontWeight: &quot;500&quot;
  },
  ratingLabels: {
    textAlign: &quot;center&quot;,
    fontSize: 18,
    fontWeight: &quot;bold&quot;
  }
});
export default VideoDetailScreen;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
